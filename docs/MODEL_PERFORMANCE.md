# 모델 성능 비교표

> 최종 업데이트: 2026-02-19

---

## 0. 이진 분류 성능 (정상 vs 불량)

> 정상 = cell_normal + module_normal
> 불량 = cell_porosity + module_porosity + module_resin_overflow

### CT CNN 모델 (테스트 기준)

| 날짜 | 모델 | 전처리 | 불량 Recall | 불량 Precision | 정상 Recall | Accuracy | 비고 |
|------|------|--------|-------------|----------------|-------------|----------|------|
| 01-05 | ResNet18 | Raw Resize 512 | 78.6% | 74.0% | 76.5% | 77.4% | |
| 01-06 | ResNet18+CBAM | Raw Resize 512 | 82.0% | 68.7% | 65.3% | 74.6% | |
| 01-19 | ResNet18 | Preprocess 1024 | 76.1% | 69.9% | 77.4% | 76.6% | |
| 01-29 | Metadata+Patch | Patch 512 | 99.6% | 99.3% | 84.8% | 93.2% | ⚠️ 오버피팅 |
| 02-01 | Metadata+Patch+Bal | Patch 512 | 99.4% | 99.3% | 91.5% | 98.8% | ⚠️ 오버피팅 |
| 02-03 | Image-Only | Outline Crop 1024 | 68.8% | 87.9% | 92.1% | 81.5% | ✅ 현실적 |
| 02-04 | Late Fusion | Outline Crop 1024 | 73.3% | 88.9% | 92.3% | 83.7% | ✅ 현실적 |
| 02-06 | ResNet18 | Resize 512 | 96.2% | 91.4% | 41.4% | 88.9% | x축 포함, 정상 Recall 저조 |
| 02-06 | ConvNeXt-Tiny | Resize 512 | 97.8% | 94.5% | 62.7% | 93.2% | x축 포함 |
| 02-07 | ConvNeXt-Tiny | Resize 512 (no x) | 98.7% | 99.7% | 98.0% | 98.6% | ⚠️ x축 제외 |
| 02-11 | ResNet18 | Resize 512 (no x test) | 96.9% | 99.4% | 96.1% | 96.8% | ⚠️ x축 제외 테스트 |
| 02-12 | CBAM (768) | Resize 768 | 81.9% | 82.8% | 89.2% | 86.4% | ✅ 균형 분할 (현재 split) |
| 02-14 | ResNet18 no_x | Resize 512 | 75.7% | 56.7% | 63.3% | 68.1% | ❌ 현재 split, 성능 저조 |
| 02-14 | ConvNeXt no_x | Resize 512 | 80.5% | 53.1% | 54.9% | 64.8% | ❌ 현재 split, 성능 저조 |
| 02-14 | CBAM 768 no_x | Resize 768 | 67.5% | 52.4% | 61.2% | 63.6% | ❌ 현재 split, 성능 저조 |
| 02-14 | EfficientNet-B4 no_x | Resize 512 | 80.2% | 56.8% | 61.4% | 68.7% | ❌ 현재 split, no_x 최고 |
| 02-14 | HD-CNN v2 | Resize 512 | 73.1% | 43.1% | 38.9% | 52.1% | ❌ 현재 split, 성능 극히 저조 |
| 02-14 | Metadata v3 | Resize 512 | 79.2% | 68.9% | 77.3% | 78.0% | ✅ 현재 split, 메타데이터 효과 |
| **02-14** | **Late Fusion v2** | **Resize 512** | **72.1%** | **75.9%** | **85.5%** | **80.3%** | **✅ 현재 split, 최고 성능** |
| 02-18 | DRN+ASPP | Resize 512 | 83.0% | 67.9% | 75.1% | 78.2% | ✅ 현재 split, 다중스케일 |
| 02-14 | EfficientNet-B0 | Resize 512 | 99.4% | 99.6% | 97.5% | 99.1% | ⚠️ 이전 split (32,492), 무효 |

### AutoEncoder 모델 (테스트 기준)

| 날짜 | 모델 | 전처리 | 불량 Recall | 불량 Precision | 정상 Recall | ROC-AUC |
|------|------|--------|-------------|----------------|-------------|---------|
| 01-07 | RGB AE | Original | 99.9% | 98.9% | 81.1% | 0.909 |
| 01-28 | CT AE | Outline Crop 1024 | 80.8% | 51.9% | 37.3% | 0.653 |

### 핵심 지표 해석

- **불량 Recall (민감도)**: 실제 불량 중 불량으로 탐지한 비율 → 높을수록 불량 놓치지 않음
- **불량 Precision**: 불량 예측 중 실제 불량 비율 → 높을수록 오탐(정상→불량) 적음
- **정상 Recall (특이도)**: 실제 정상 중 정상으로 판정한 비율 → 높을수록 정상을 불량으로 오탐 안함

---

## 1. CT CNN 전체 학습 기록

### 1.1 학습별 Best Validation F1

| 날짜 | 모델 | 전처리 | Best Val F1 | Best Epoch | 비고 |
|------|------|--------|-------------|------------|------|
| **01-05** | ResNet18 | Raw Resize 512 | 0.8335 | 15 | 기본 모델 |
| 01-06 | ResNet18+CBAM | Raw Resize 512 | 0.8066 | 1 | CBAM 추가 (성능 하락) |
| 01-18 | ResNet18 | Preprocess 1024 | 0.7909 | 1 | Albumentations 적용 |
| 01-18 | ResNet18 | Preprocess 1024 | 0.8291 | 4 | Albumentations 적용 |
| **01-19** | ResNet18 | Preprocess 1024 | 0.8275 | 5 | 테스트 결과 있음 |
| 01-20 | ResNet18 | Preprocess 1024 | 0.8087 | 1 | - |
| 01-20 | ResNet18 | Preprocess 1024 | 0.8347 | 2 | - |
| 01-21 | ResNet18 | Preprocess 1024 | 0.8361 | 2 | - |
| 01-21 | ResNet18 | Preprocess 1024 | 0.6218 | 9 | 과적합 |
| 01-22 | ResNet18+CBAM | Preprocess 1024 | 0.6221 | 10 | CBAM 재실험 (실패) |
| 01-23 | ResNet18 | Preprocess 1024 | 0.8369 | 2 | - |
| 01-24 | Hierarchical | Preprocess 1024 | 0.1298 | 1 | 계층 모델 (실패) |
| 01-25 | ResNet18 | Preprocess 1024 | 0.6020 | 1 | - |
| 01-25 | ResNet18 | Preprocess 1024 | 0.7858 | 6 | - |
| 01-25 | ResNet18 | Preprocess 1024 | 0.7979 | 2 | - |
| 01-26 | Metadata | Preprocess 1024 | **1.0000** | 1 | ⚠️ 이미지 스타일 학습 |
| 01-26 | Metadata | Preprocess 1024 | **1.0000** | 2 | ⚠️ 이미지 스타일 학습 |
| 01-26 | Metadata | Preprocess 1024 | 0.7718 | 4 | 메타데이터 의존도 감소 후 |
| 01-26 | Metadata | Preprocess 1024 | 0.7851 | 4 | 메타데이터 의존도 감소 후 |
| 01-28 | Metadata | Outline Crop 1024 | 0.9999 | 5 | ⚠️ 축(axis) 학습 문제 |
| 01-28 | Metadata | Outline Crop 1024 | 0.9944 | 7 | ⚠️ 축(axis) 학습 문제 |
| 01-29 | Metadata | Outline Crop 1024 | 0.9978 | 6 | ⚠️ 축(axis) 학습 문제 |
| 01-29 | Metadata | Outline Crop 1024 | 0.9385 | 2 | axis 메타데이터 추가 |
| **01-29** | Metadata | Patch 512 | 0.8299 | 1 | 패치 전략, 테스트 F1=0.874 |
| **02-01** | Metadata | Patch 512 (Balanced) | 0.8874 | 2 | 클래스 밸런싱, 테스트 F1=0.948 |
| **02-02** | Image-Only | Outline Crop 1024 | 0.7553 | 6 | 메타데이터 없이 순수 이미지만 |
| **02-03** | Late Fusion | Outline Crop 1024 | 0.8262 | - | 메타데이터 raw concat |
| **02-04** | HD-CNN | Outline Crop 1024 | 0.6061 | 4 | Coarse/Fine 분기 (성능 저조) |
| 02-12 | ResNet18 no_x | Resize 512 (no x) | 0.7123 | 5/12 | 과적합, Early Stop |
| 02-12 | ConvNeXt-Tiny no_x | Resize 512 (no x) | 0.7708 | 4/11 | 과적합, Early Stop |
| 02-12 | CBAM 768 no_x | Resize 768 (no x) | 0.7307 | 1/8 | 과적합 (심각), epoch 1 최고 |
| 02-12 | EfficientNet-B4 no_x | Resize 512 (no x) | 0.7661 | 5/12 | 과적합, Early Stop |
| 02-13 | HD-CNN v2 | Resize 512 | 0.5472 | 7/14 | 극심한 과적합 (val_loss 폭등) |
| 02-13 | Metadata v3 | Resize 512 | 0.7930 | 5/13 | 과적합 |
| **02-14** | **Late Fusion v2** | **Resize 512** | **0.8243** | **5/12** | **경미한 과적합, 가장 안정적** |
| 02-15 | DRN+ASPP | Resize 512 | 0.7893 | 9/16 | 심각한 과적합 (val_loss 폭등) |
| 02-18 | DeepLabV3+ (freeze) | Resize 512 | 0.3024 | 7/9 | ❌ backbone freeze, 학습 실패 |

### 1.2 테스트 결과가 있는 모델

> ⚠️ **중요**: 02-12에 `fix_all_ct_splits.py`로 split 재생성 → 이전 split 기반 결과는 현재 데이터와 불일치
> - **현재 split**: 35,529 샘플 (cell_n=10,655, cell_p=3,870, mod_n=11,089, mod_p=9,542, mod_r=373)
> - 이전 split은 클래스 분포가 크게 다름 → 직접 비교 불가

#### 현재 split 기반 결과 (35,529 샘플) ✅

| 날짜 | 모델 | 전처리 | Test F1 Macro | Test Accuracy | ROC-AUC | 비고 |
|------|------|--------|---------------|---------------|---------|------|
| **02-14** | **Late Fusion v2** | **Resize 512** | **0.803** | **80.3%** | **0.944** | **✅ 현재 split 최고** |
| 02-18 | DRN+ASPP | Resize 512 | 0.794 | 78.2% | 0.943 | ✅ 다중스케일 특징 추출 |
| 02-14 | Metadata v3 | Resize 512 | 0.791 | 78.0% | 0.965 | ✅ 메타데이터 효과 |
| 02-12 | CBAM (768) | Resize 768 | 0.862 | 86.3% | 0.968 | ✅ x축 포함 학습 |
| 02-14 | EfficientNet-B4 no_x | Resize 512 | 0.679 | 66.7% | 0.912 | no_x 학습 → 전체 테스트 |
| 02-14 | ConvNeXt no_x | Resize 512 | 0.571 | 64.6% | 0.891 | no_x 학습 → 전체 테스트 |
| 02-14 | ResNet18 no_x | Resize 512 | 0.545 | 60.1% | 0.864 | no_x 학습 → 전체 테스트 |
| 02-14 | CBAM 768 no_x | Resize 768 | 0.540 | 60.3% | 0.895 | no_x 학습 → 전체 테스트 |
| 02-14 | HD-CNN v2 | Resize 512 | 0.337 | 38.5% | - | ❌ 성능 극히 저조 |

#### 이전 split 기반 결과 (참고용, 직접 비교 불가) ⚠️

| 날짜 | 모델 | 전처리 | Test F1 Macro | Test Accuracy | Test 샘플 | 비고 |
|------|------|--------|---------------|---------------|-----------|------|
| 01-05 | ResNet18 | Raw Resize 512 | 0.788 | 77.4% | 36,424 | 이전 split |
| 01-06 | ResNet18+CBAM | Raw Resize 512 | 0.584 | 74.6% | 36,424 | 이전 split |
| 01-19 | ResNet18 | Preprocess 1024 | 0.696 | 76.6% | 36,424 | 이전 split |
| 01-29 | Metadata | Patch 512 | 0.874 | 93.2% | 355,256 패치 | ⚠️ 오버피팅 |
| 02-01 | Metadata | Patch 512 (Balanced) | 0.948 | 98.7% | 355,256 패치 | ⚠️ 오버피팅 |
| 02-03 | Image-Only | Outline Crop 1024 | 0.792 | 81.5% | 34,220 | outline crop split |
| 02-04 | Late Fusion | Outline Crop 1024 | 0.826 | 83.7% | 34,220 | outline crop split |
| 02-05 | HD-CNN | Outline Crop 1024 | 0.690 | 65.2% | 34,220 | outline crop split |
| 02-06 | ResNet18 | Resize 512 (x포함) | 0.645 | 88.7% | 36,424 | 이전 split |
| 02-06 | ConvNeXt-Tiny | Resize 512 (x포함) | 0.864 | 93.1% | 36,424 | 이전 split |
| 02-07 | ConvNeXt-Tiny | Resize 512 (no x) | 0.976 | 98.6% | 29,899 | ⚠️ 이전 split (삭제됨) |
| 02-11 | ResNet18 | Resize 512 (no x test) | 0.949 | 96.8% | 32,492 | ⚠️ 이전 split (삭제됨) |
| 02-14 | EfficientNet-B0 | Resize 512 (no x) | 0.987 | 99.1% | 32,492 | ⚠️ 이전 split (삭제됨) |

### 1.3 클래스별 F1 Score (테스트 기준)

| 모델 (날짜) | cell_normal | cell_porosity | module_normal | module_porosity | module_resin |
|-------------|-------------|---------------|---------------|-----------------|--------------|
| ResNet18 (01-05) | 0.654 | 0.490 | 0.894 | 0.903 | 1.000 |
| ResNet18+CBAM (01-06) | 0.627 | 0.444 | 0.874 | 0.893 | 0.083 |
| ResNet18 (01-19) | 0.665 | 0.378 | 0.896 | 0.906 | 0.635 |
| Metadata+Patch (01-29) | 0.840 | 0.937 | 0.636 | 0.964 | 0.993 |
| Metadata+Patch+Bal (02-01) | 0.839 | 0.946 | 0.972 | 0.998 | 0.983 |
| Image-Only (02-03) | 0.782 | 0.384 | 0.898 | 0.896 | 1.000 |
| Late Fusion (02-04) | 0.794 | 0.513 | 0.915 | 0.908 | 1.000 |
| HD-CNN (02-05) | 0.537 | 0.391 | 0.613 | 0.907 | 1.000 |
| ResNet18 Resize512 (02-06) | 0.415 | 0.883 | 0.623 | 0.969 | 0.335 |
| ConvNeXt Resize512 (02-06) | 0.734 | 0.943 | 0.673 | 0.971 | 1.000 |
| ConvNeXt no_x (02-07) | **0.943** | **0.984** | **0.957** | **0.995** | **1.000** |
| ResNet18 no_x test (02-11) | 0.896 | 0.968 | 0.891 | 0.990 | 1.000 |
| CBAM 768 (02-12) | 0.860 | 0.645 | 0.912 | 0.895 | 1.000 |
| ResNet18 no_x (02-14) | 0.640 | 0.482 | 0.464 | 0.762 | 0.380 |
| ConvNeXt no_x (02-14) | 0.837 | 0.630 | 0.416 | 0.681 | 0.292 |
| CBAM 768 no_x (02-14) | 0.716 | 0.269 | 0.483 | 0.763 | 0.469 |
| EfficientNet-B4 no_x (02-14) | 0.691 | 0.546 | 0.647 | 0.721 | 0.791 |
| HD-CNN v2 (02-14) | 0.031 | 0.412 | 0.303 | 0.857 | 0.081 |
| Metadata v3 (02-14) | 0.720 | 0.481 | 0.889 | 0.866 | 1.000 |
| DRN+ASPP (02-18) | 0.667 | 0.492 | 0.917 | 0.897 | 1.000 |
| **Late Fusion v2 (02-14)** | **0.796** | **0.488** | **0.883** | **0.846** | **1.000** |

### 1.4 클래스별 Precision (테스트 기준)

| 모델 (날짜) | cell_normal | cell_porosity | module_normal | module_porosity | module_resin |
|-------------|-------------|---------------|---------------|-----------------|--------------|
| ResNet18 (01-05) | 63.8% | 50.8% | 96.1% | 84.8% | 100% |
| ResNet18+CBAM (01-06) | 64.4% | 44.8% | 98.2% | 81.7% | 4.3% |
| ResNet18 (01-19) | 60.0% | 47.1% | 95.7% | 85.7% | 46.6% |
| Metadata+Patch (01-29) | 78.2% | 96.5% | 46.7% | 99.9% | 98.5% |
| Metadata+Patch+Bal (02-01) | 88.0% | 93.2% | 96.1% | 99.9% | 96.6% |
| Image-Only (02-03) | 68.6% | 63.8% | 86.8% | 92.6% | 100% |
| Late Fusion (02-04) | 71.9% | 68.3% | 88.2% | 94.7% | 100% |
| HD-CNN (02-05) | 40.2% | 57.1% | 90.9% | 94.6% | 100% |
| ResNet18 Resize512 (02-06) | 64.0% | 82.3% | 61.5% | 97.5% | 20.1% |
| ConvNeXt Resize512 (02-06) | **98.4%** | 89.3% | 64.0% | 97.7% | 100% |
| ConvNeXt no_x (02-07) | 89.5% | **99.9%** | 95.5% | **99.6%** | 100% |
| ResNet18 no_x test (02-11) | 83.2% | 99.1% | 84.8% | 99.5% | 100% |
| CBAM 768 (02-12) | 87.5% | 61.5% | 89.2% | 92.2% | 100% |
| ResNet18 no_x (02-14) | 62.5% | 38.3% | 66.4% | 73.5% | 23.5% |
| ConvNeXt no_x (02-14) | 87.5% | 57.6% | 68.3% | 57.2% | 17.1% |
| CBAM 768 no_x (02-14) | 69.0% | 21.8% | 66.8% | 73.3% | 30.6% |
| EfficientNet-B4 no_x (02-14) | 86.6% | 42.2% | 72.3% | 65.2% | 65.4% |
| HD-CNN v2 (02-14) | 28.0% | 33.2% | 29.7% | 92.8% | 4.2% |
| Metadata v3 (02-14) | 82.7% | 38.8% | 87.4% | 88.4% | 100% |
| DRN+ASPP (02-18) | 84.9% | 37.1% | 89.0% | 93.2% | 100% |
| **Late Fusion v2 (02-14)** | **81.7%** | **45.8%** | **83.8%** | **90.9%** | **100%** |

### 1.5 클래스별 Recall (테스트 기준)

| 모델 (날짜) | cell_normal | cell_porosity | module_normal | module_porosity | module_resin |
|-------------|-------------|---------------|---------------|-----------------|--------------|
| ResNet18 (01-05) | 67.1% | 47.2% | 83.6% | 96.5% | 100% |
| ResNet18+CBAM (01-06) | 61.1% | 43.9% | 78.7% | 98.5% | 100% |
| ResNet18 (01-19) | 74.4% | 31.6% | 84.3% | 96.0% | 100% |
| Metadata+Patch (01-29) | 90.7% | 91.1% | 99.4% | 93.1% | 100% |
| Metadata+Patch+Bal (02-01) | 80.2% | 96.0% | 98.3% | 99.7% | 100% |
| Image-Only (02-03) | 90.8% | 27.5% | 93.0% | 86.8% | 100% |
| Late Fusion (02-04) | 88.7% | 41.1% | 95.1% | 87.3% | 100% |
| HD-CNN (02-05) | 81.1% | 29.7% | 46.2% | 87.0% | 100% |
| ResNet18 Resize512 (02-06) | 30.6% | 95.2% | 63.0% | 96.4% | 100% |
| ConvNeXt Resize512 (02-06) | 58.6% | **100%** | 71.0% | 96.6% | 100% |
| ConvNeXt no_x (02-07) | **99.6%** | 97.0% | 96.0% | **99.5%** | 100% |
| ResNet18 no_x test (02-11) | 97.1% | 94.5% | 93.9% | 98.6% | 100% |
| CBAM 768 (02-12) | 84.6% | 67.8% | 93.3% | 86.9% | 100% |
| ResNet18 no_x (02-14) | 65.5% | 64.9% | 35.6% | 79.1% | 100% |
| ConvNeXt no_x (02-14) | 80.3% | 69.5% | 29.9% | 84.1% | 100% |
| CBAM 768 no_x (02-14) | 74.4% | 35.0% | 37.9% | 79.4% | 100% |
| EfficientNet-B4 no_x (02-14) | 57.5% | 77.3% | 58.6% | 80.6% | 100% |
| HD-CNN v2 (02-14) | 1.6% | 54.3% | 30.9% | 79.6% | 100% |
| Metadata v3 (02-14) | 63.7% | 63.2% | 90.4% | 84.8% | 100% |
| DRN+ASPP (02-18) | 54.9% | 73.1% | 94.6% | 86.4% | 100% |
| **Late Fusion v2 (02-14)** | **77.5%** | **52.2%** | **93.2%** | **79.1%** | **100%** |

### 1.6 클래스별 문제점 분석

#### cell_normal vs cell_porosity 혼동
| 모델 | cell_normal→porosity | cell_porosity→normal | 총 혼동 |
|------|---------------------|---------------------|---------|
| ResNet18 (01-05) | 2,786 | 3,216 | 6,002 (41%) |
| ResNet18+CBAM (01-06) | 3,292 | 2,824 | 6,116 (42%) |
| ResNet18 (01-19) | 2,167 | 4,169 | 6,336 (44%) |
| Metadata+Patch (01-29) | 993 | 2,714 | 3,707 (9%) |
| Metadata+Patch+Bal (02-01) | 2,130 | 1,171 | 3,301 (8%) |
| Image-Only (02-03) | 748 | 3,384 | 4,132 (32%) |
| Late Fusion (02-04) | 918 | 2,830 | 3,748 (29%) |
| HD-CNN (02-05) | 1,071 | 3,365 | 4,436 (34%) |
| ResNet18 Resize512 (02-06) | **2,247** | 545 | 2,792 (19%) |
| ConvNeXt Resize512 (02-06) | 1,342 | 0 | 1,342 (9%) |
| ConvNeXt no_x (02-07) | 8 | 261 | 269 (2.4%) |
| ResNet18 no_x test (02-11) | 95 | 629 | 724 (4.9%) |
| CBAM 768 (02-12) | 1,643 | 1,246 | 2,889 (20%) |
| ResNet18 no_x (02-14) | 3,467 | 1,358 | 4,825 (33%) |
| ConvNeXt no_x (02-14) | 1,920 | 1,179 | 3,099 (21%) |
| CBAM 768 no_x (02-14) | 2,526 | 2,517 | 5,043 (35%) |
| EfficientNet-B4 no_x (02-14) | 3,834 | 880 | 4,714 (32%) |
| Metadata v3 (02-14) | 3,864 | 1,424 | 5,288 (36%) |
| DRN+ASPP (02-18) | 4,800 | 1,042 | 5,842 (40%) |
| Late Fusion v2 (02-14) | 2,394 | 1,848 | 4,242 (29%) |

#### module_normal vs module_porosity 혼동
| 모델 | module_normal→porosity | module_porosity→normal | 총 혼동 |
|------|----------------------|----------------------|---------|
| ResNet18 (01-05) | 1,836 | 377 | 2,213 (10%) |
| ResNet18+CBAM (01-06) | 2,345 | 159 | 2,504 (11%) |
| ResNet18 (01-19) | 1,707 | 426 | 2,133 (10%) |
| Metadata+Patch (01-29) | 104 | 20,274 | 20,378 (7%) |
| Metadata+Patch+Bal (02-01) | 300 | 713 | 1,013 (0.3%) |
| Image-Only (02-03) | 728 | 1,379 | 2,107 (10%) |
| Late Fusion (02-04) | 509 | 1,332 | 1,841 (9%) |
| HD-CNN (02-05) | 516 | 1,361 | 1,877 (9%) |
| ResNet18 Resize512 (02-06) | 500 | 639 | 1,139 (5.2%) |
| ConvNeXt Resize512 (02-06) | 467 | 648 | 1,115 (5.1%) |
| ConvNeXt no_x (02-07) | 74 | 83 | 157 (0.8%) |
| ResNet18 no_x test (02-11) | 81 | 223 | 304 (1.7%) |
| CBAM 768 (02-12) | 703 | 1,250 | 1,953 (9.5%) |
| ResNet18 no_x (02-14) | 2,714 | 1,997 | 4,711 (23%) |
| ConvNeXt no_x (02-14) | 5,874 | 1,514 | 7,388 (36%) |
| CBAM 768 no_x (02-14) | 2,686 | 1,962 | 4,648 (23%) |
| EfficientNet-B4 no_x (02-14) | 4,056 | 1,847 | 5,903 (29%) |
| Metadata v3 (02-14) | 1,065 | 1,450 | 2,515 (12%) |
| DRN+ASPP (02-18) | 599 | 1,296 | 1,895 (9%) |
| **Late Fusion v2 (02-14)** | **751** | **1,995** | **2,746 (13%)** |

#### HD-CNN 특이 문제: module_normal → cell_normal 혼동
| 모델 | module_normal→cell_normal | 비율 |
|------|--------------------------|------|
| HD-CNN (02-05) | **5,113** | **48.8%** |
| Late Fusion (02-04) | 0 | 0% |

### 1.7 클래스별 개선 추이

```
                    01-05    01-06    01-19    01-29    02-01    02-03    02-04    02-05
                   (Raw512) (CBAM)   (Prep)   (Patch)  (Balanced)(ImgOnly)(LateFus)(HD-CNN)
cell_normal F1:     0.654    0.627    0.665    0.840    0.839    0.782    0.794    0.537 ↓
cell_porosity F1:   0.490    0.444    0.378    0.937    0.946    0.384    0.513    0.391
module_normal F1:   0.894    0.874    0.896    0.636    0.972    0.898    0.915    0.613 ↓
module_porosity:    0.903    0.893    0.906    0.964    0.998    0.896    0.908    0.907
module_resin F1:    1.000    0.083    0.635    0.993    0.983    1.000    1.000    1.000
```

**핵심 개선점**:
- `cell_porosity`: 0.378 → 0.946 (2.5배 향상, 패치+밸런싱 효과)
- `module_normal`: Precision 47% → 96% (밸런싱으로 해결)
- `module_resin`: CBAM에서 0.083으로 붕괴 → 이후 복구

**Image-Only (02-03) 분석**:
- cell_porosity에서 0.384로 성능 저조 (메타데이터/패치 없이 탐지 어려움)
- module 계열은 양호 (module_resin 100%)

**Late Fusion (02-04) 분석**:
- cell_porosity F1 0.384 → 0.513 (+12.9%p) - 메타데이터가 도움
- cell_porosity Recall 27.5% → 41.1% (+13.6%p)
- 전체 F1 0.792 → 0.826 (+3.4%p)

---

## 2. AutoEncoder 전체 학습 기록

### 2.1 CT AutoEncoder

| 날짜 | 전처리 | Best Val Loss | Best ROC-AUC | Epochs | 상태 |
|------|--------|---------------|--------------|--------|------|
| 01-27~28 | Outline Crop 1024 | 0.182 | 0.710 (epoch 6) | 30+ | 완료 |

**테스트 결과** (01-28):
- ROC-AUC: 0.653
- Binary F1: 0.632
- 문제점: Cell/Module 구분 실패, module_normal 정확도 13.7%

### 2.2 RGB AutoEncoder

| 날짜 | 전처리 | Best Val Loss | Test ROC-AUC | Test F1 | 상태 |
|------|--------|---------------|--------------|---------|------|
| 01-06 | Original | - | 0.964 | 0.984 | 완료 |
| 01-07 | Original | - | **0.909** | **0.994** | 최종 사용 |

### 2.3 VLM (Vision-Language Model) 평가

> Qwen2-VL → Qwen3-VL로 업그레이드 (02-13)
> API 모델: Gemini 2.0 Flash → Gemini 2.5 Pro로 변경 (02-21)

#### VLM 모델 선정 기준

본 프로젝트에서는 CNN 기반 분류 모델을 보완하기 위해 VLM을 도입하였다. VLM의 역할은 **결함 위치 시각화(Grounding)** 및 **자연어 기반 소견 생성**이며, 로컬 모델과 API 모델을 이원화하여 운용한다.

##### 선정 기준

| 기준 | 중요도 | 설명 |
|------|--------|------|
| **결함 위치 출력 (Grounding)** | ★★★ | 바운딩 박스 좌표를 네이티브로 출력할 수 있는지 여부. 검사 시스템에서 불량 위치 시각화 필수 |
| **Zero-shot 검출 성능** | ★★★ | 배터리 도메인 학습 없이 즉시 사용 가능한 성능. RF100-VL 벤치마크 기준 |
| **한국어 지원** | ★★☆ | 프롬프트 및 소견 출력이 한국어로 가능한지 |
| **비용 효율성** | ★★☆ | 이미지당 API 호출 비용. 대량 검사 시 운용 비용 |
| **로컬 실행 가능 여부** | ★★☆ | 데이터 보안 및 오프라인 환경 대응 |

##### 후보 모델 비교

| 모델 | 바운딩 박스 | Zero-shot mAP (RF100-VL) | 한국어 | 이미지당 비용 | 로컬 실행 |
|------|-----------|--------------------------|--------|-------------|----------|
| **Gemini 2.5 Pro** | O (네이티브) | **13.3 (VLM 1위)** | 우수 | ~$0.01 | X (API 전용) |
| Gemini 2.5 Flash | O (네이티브) | 양호 | 우수 | ~$0.002 | X (API 전용) |
| **Qwen3-VL** | O (절대 픽셀 좌표) | 7.5~9.2 | 최우수 (CJK 특화) | 무료 (로컬) | **O (3B~72B)** |
| GPT-4o | X (부정확) | - | 우수 | ~$0.02 | X |
| Claude Sonnet | X (비일관적) | - | 우수 | ~$0.03 | X |

##### 선정 결과

| 역할 | 선정 모델 | 선정 사유 |
|------|----------|----------|
| **로컬 모델** | **Qwen3-VL (8B)** | 오픈소스로 로컬 GPU 실행 가능, 바운딩 박스 네이티브 지원, 한국어 CJK 최우수, 데이터 외부 유출 없음, 3D 공간 인식(CT 볼류메트릭 분석 활용 가능) |
| **API 모델** | **Gemini 2.5 Pro** | VLM 중 zero-shot 객체 검출 성능 최고(mAP 13.3), 바운딩 박스 네이티브 지원, 합리적 비용 |

##### 탈락 모델 사유

| 모델 | 탈락 사유 |
|------|----------|
| GPT-4o | 바운딩 박스 좌표 출력 부정확, 환각(hallucination) 발생 빈번. 분류 정확도(74.9%)는 양호하나 위치 특정 불가 |
| Claude Sonnet/Opus | 시각적 grounding 능력 부족, 좌표 출력 비일관적. 텍스트 추론에 강점이나 검사 시스템 요구사항 미충족 |
| Gemini 2.5 Flash | 성능 대비 비용 우수하나, Pro 대비 검출 정밀도 낮음. 비용 최적화 필요 시 대안으로 고려 |

##### 참고: VLM Zero-shot 한계

> 최고 성능 VLM도 산업 결함 검출에서 **mAP ~13 수준** (GroundingDINO fine-tuned 33.3 대비 낮음).
> VLM은 **1차 스크리닝 및 소견 생성** 용도로 활용하고, 정밀 판정은 CNN 모델이 담당하는 구조로 설계.
> Few-shot (참고 이미지 1~4장 제공) 시 성능 대폭 향상 가능 (AnomalyGPT 기준 94%+ AUC).

#### 모델별 평가 결과

| 날짜 | 모델 | 크기 | 샘플 수 | Accuracy | F1 Macro | ROC-AUC | 비고 |
|------|------|------|---------|----------|----------|---------|------|
| 02-13 | Qwen3-VL | 8B | 1 | 100% | 1.000 | - | ⚠️ 1샘플 테스트 (의미 없음) |
| 02-13 | Qwen3-VL | 2B | 5 | 20% | 0.067 | 0.65 | ❌ 모두 cell_normal로 예측 |
| **02-19** | **Qwen3-VL** | **2B** | **500** | **20.8%** | **0.082** | **0.547** | **❌ 대규모 평가 확정: zero-shot 무의미** |

#### 대규모 평가 상세 (02-19, Qwen3-VL 2B, 500샘플)

| 클래스 | Precision | Recall | F1 | Support |
|--------|-----------|--------|-----|---------|
| cell_normal | 0.204 | **1.000** | 0.340 | 100 |
| cell_porosity | 0.000 | 0.000 | 0.000 | 100 |
| module_normal | 0.364 | 0.040 | 0.072 | 100 |
| module_porosity | 0.000 | 0.000 | 0.000 | 100 |
| module_resin_overflow | 0.000 | 0.000 | 0.000 | 100 |

- 소요 시간: 1,091초 (~18분), 0.46 samples/sec
- 파싱 실패: 0건
- 신뢰도: 정답 99.0% / 오답 98.1% (자신만만하게 틀림)

#### 분석

- **Qwen3-VL 2B (500샘플 확정)**: 거의 모든 이미지를 `cell_normal`로 예측 (489/500)
  - cell_normal Recall=100% (전부 cell_normal이라 답함), Precision=20.4%
  - module_normal만 4장 정답, 나머지 3클래스 Recall=0%
  - **Accuracy 20.8%는 5클래스 균등 랜덤(20%)과 동등** → zero-shot 분류 능력 없음
- **Qwen3-VL 8B**: 1개 샘플만 테스트, GPU 12GB 제약으로 대규모 평가 미실시
- **한계**: VLM은 CT 이미지의 미세 결함 구분이 불가능 (cell_porosity vs cell_normal 등)
- **결론**: CT 5클래스 분류에는 **fine-tuning이 필수**이며, zero-shot VLM은 참고 의견 수준으로만 활용 가능

---

## 3. 전처리 전략별 비교

### 3.1 전처리 유형

| 전처리 | 설명 | 이미지 크기 | 데이터 수 | 기간 |
|--------|------|------------|-----------|------|
| Raw Resize | 원본 4000→512 리사이즈 | 512 | 140K | 01-05~06 |
| Preprocess | Albumentations 전처리 | 1024 | 140K | 01-18~26 |
| Outline Crop | 배터리 외곽선 crop v2 | 1024 | 179K | 01-27~28 |
| Patch 512 | Outline에서 512x512 분할 | 512 | 1.33M | 01-29~ |
| Patch Balanced | Patch + Class 3 언더샘플링 | 512 | 325K | 02-01~ |

### 3.2 전처리별 최고 성능

| 전처리 | Best Model | Val F1 | Test F1 | 비고 |
|--------|------------|--------|---------|------|
| Raw Resize 512 | ResNet18 (01-05) | 0.834 | 0.788 | 기본 |
| Raw Resize 512 + CBAM | ResNet18+CBAM (01-06) | 0.807 | 0.584 | 실패 |
| Preprocess 1024 | ResNet18 (01-19) | 0.828 | 0.696 | 전처리 적용 |
| Outline Crop 1024 | Image-Only (02-03) | 0.755 | 0.792 | ✅ 현실적 |
| Outline Crop 1024 | Late Fusion (02-04) | 0.826 | 0.826 | ✅ 현실적 |
| Patch 512 | Metadata (01-29) | 0.830 | 0.874 | ⚠️ 오버피팅 |
| Patch Balanced | Metadata (02-01) | 0.887 | 0.948 | ⚠️ 오버피팅 |
| Resize 512 (x포함) | ConvNeXt-Tiny (02-06) | - | 0.864 | x축 포함 |
| **Resize 512 (no x)** | **ConvNeXt-Tiny (02-07)** | **-** | **0.976** | **⚠️ x축 제외, 최고 F1** |
| Resize 512 (no x test) | ResNet18 (02-11) | - | 0.949 | ⚠️ x축 제외 테스트 |
| Resize 768 (균형) | CBAM (02-12) | - | 0.862 | ✅ 균형 분할 |

---

## 4. 과적합 분석

### 4.1 학습별 과적합 지표

| 학습 | 전처리 | First Train | Last Train | Best Epoch / Total | 과적합 |
|------|--------|-------------|------------|-------------------|--------|
| 01-05 (기본) | Raw 512 | 0.198 | 0.031 | 15/18 | 경미 |
| 01-06 CBAM | Raw 512 | 0.211 | 0.060 | 1/11 | **심각** |
| 01-18 | Preprocess | 0.321 | 0.125 | 4/14 | 중간 |
| 01-19 | Preprocess | 0.346 | 0.110 | 5/10 | 중간 |
| 01-20 | Preprocess | 0.107 | 0.035 | 1/6 | **심각** |
| 01-20 | Preprocess | 0.157 | 0.055 | 2/6 | **심각** |
| 01-21 | Preprocess | 0.268 | 0.107 | 2/6 | **심각** |
| 01-21 | Preprocess | 0.190 | 0.047 | 9/13 | 중간 |
| 01-22 CBAM | Preprocess | 0.207 | 0.050 | 10/14 | 중간 |
| 01-23 | Preprocess | 0.328 | 0.184 | 2/6 | **심각** |
| 01-24 Hierarchical | Preprocess | 0.492 | 0.302 | 1/8 | 실패 |
| 01-25 | Preprocess | 0.637 | 0.559 | 1/5 | **심각** |
| 01-25 | Preprocess | 0.323 | 0.194 | 6/6 | 경미 |
| 01-25 | Preprocess | 0.309 | 0.177 | 2/6 | **심각** |
| 01-26 Metadata | Preprocess | 0.909 | 0.160 | 1/6 | 데이터 문제 |
| 01-26 Metadata | Preprocess | 1.046 | 0.169 | 2/7 | 데이터 문제 |
| 01-26 Metadata | Preprocess | 2.320 | 0.283 | 4/9 | 중간 |
| 01-26 Metadata | Preprocess | 1.949 | 0.256 | 4/9 | 중간 |
| 01-28 Metadata | Outline | 0.391 | 0.074 | 5/15 | 축 학습 문제 |
| 01-28 Metadata | Outline | 0.582 | 0.090 | 7/14 | 축 학습 문제 |
| 01-29 Metadata | Outline | 0.613 | 0.110 | 6/6 | 축 학습 문제 |
| 01-29 Metadata | Outline | 1.062 | 0.123 | 2/7 | 중간 |
| 01-29 Metadata | Patch | 0.251 | 0.074 | 1/6 | **심각** |
| 02-01 Metadata | Patch Bal | 0.393 | 0.055 | 2/7 | **심각** |
| 02-12 ResNet18 no_x | Resize 512 | 0.214 | 0.074 | 5/12 | **심각** (val 0.734→1.190) |
| 02-12 ConvNeXt no_x | Resize 512 | 0.150 | 0.065 | 4/11 | **심각** (val 0.589→0.883) |
| 02-12 CBAM 768 no_x | Resize 768 | 0.220 | 0.063 | 1/8 | **극심** (val 0.484→1.166) |
| 02-12 EfficientNet-B4 no_x | Resize 512 | 0.200 | 0.052 | 5/12 | **심각** (val 0.576→1.175) |
| 02-13 HD-CNN v2 | Resize 512 | 2.539 | 0.747 | 7/14 | **극심** (val 폭등 →11.508) |
| 02-13 Metadata v3 | Resize 512 | 1.445 | 0.209 | 5/13 | **심각** (val 0.484→0.746) |
| 02-14 Late Fusion v2 | Resize 512 | 1.118 | 0.191 | 5/12 | 경미 (val 0.475→0.584) |
| 02-15 DRN+ASPP | Resize 512 | 0.182 | 0.065 | 9/16 | **심각** (val 0.392→0.904) |
| 02-18 DeepLabV3+ (freeze) | Resize 512 | 1.065 | 0.963 | 7/9 | ❌ 학습 실패 (backbone freeze, val_f1=0.302) |

### 4.2 과적합 패턴 요약

```
Train Loss: 0.2~0.6 → 0.03~0.1 (3~10배 감소)
Best Epoch: 대부분 1-2 epoch (총 6-15 중)
```

| 패턴 | 학습 수 | 비율 |
|------|---------|------|
| 심각 (Best ≤ 2 epoch) | 12회 | 48% |
| 중간 (Best 3-6 epoch) | 7회 | 28% |
| 경미 (Best > 6 epoch) | 3회 | 12% |
| 데이터 문제 | 3회 | 12% |

### 4.3 과적합 원인 분석

1. **모델 용량 과다**: ResNet18 (11M params) vs 데이터 (140K~1.3M)
2. **정규화 부족**: Dropout 0.3~0.5, Weight Decay 0.01~0.03
3. **데이터 증강 부족**: 기본 flip/rotation만 적용
4. **학습률 문제**: 초반에 급격히 수렴 후 과적합

### 4.4 권장 개선 방향

| 방법 | 현재 | 권장 |
|------|------|------|
| Dropout | 0.3~0.5 | 0.5~0.7 |
| Weight Decay | 0.01~0.03 | 0.05~0.1 |
| Label Smoothing | 0.07 | 0.1~0.15 |
| Data Augmentation | 기본 | MixUp, CutMix, RandAugment |
| Early Stopping | patience=5 | patience=3 |
| 모델 | ResNet18 | ResNet18 + 더 강한 정규화 or 더 작은 모델 |

---

## 5. 문제 발견 기록

### 5.1 이미지 스타일 학습 문제 (01-26)

- **현상**: Val F1 = 1.0000 (100%)
- **원인**: 정상/불량 이미지의 전처리 스타일 차이 학습
  - 정상: 넓은 사각형 crop
  - 불량: 가늘고 긴 defect 영역 crop
- **해결**: 패치 전략으로 통일

### 5.2 축(Axis) 학습 문제 (01-28~29)

- **현상**: x축 = 99.97% 정상, y/z축 = 결함 혼재
- **원인**: 모델이 축 정보를 암기
- **해결**: axis 메타데이터 명시적 추가

### 5.3 클래스 불균형 (01-29~02-01)

- **현상**: Class 3 (module_porosity) = 83%
- **원인**: 패치 분할 후 불균형 심화
- **해결**: Class 3 언더샘플링 (1.1M → 100K)

### 5.4 CT AE 성능 저조 (01-28)

- **현상**: ROC-AUC = 0.653
- **원인**: Cell/Module 외관 차이가 Normal/Defect 차이보다 큼
- **상태**: 미해결 (앙상블 효과 없음)

### 5.5 Image-Only cell_porosity 탐지 실패 (02-03)

- **현상**: cell_porosity Recall = 27.5% (4,805개 중 1,321개만 탐지)
- **원인**: 3,384개(70%)가 cell_normal로 오분류됨
- **분석**:
  - 메타데이터 없이 순수 이미지만으로 학습
  - cell_normal vs cell_porosity 구분이 시각적으로 어려움
  - 하지만 이것이 **현실적인 성능**일 가능성 높음

### 5.6 HD-CNN cell/module 구분 실패 (02-05) ❌

- **현상**: Test F1 = 0.690 (Late Fusion 0.826 대비 크게 저조)
- **주요 문제**:
  - module_normal Recall = 46.2% (10,470개 중 4,841개만 정답)
  - **5,113개(48.8%)가 cell_normal로 오분류**
  - cell_porosity Recall = 29.7% (Late Fusion 41.1%)
- **원인 분석**:
  1. Coarse Branch (Normal vs Defect)는 81.5%로 양호
  2. 하지만 Fine Branch에서 cell/module 구분 실패
  3. 계층적 분기가 오히려 혼란을 가중
- **결론**: HD-CNN은 이 데이터셋에 적합하지 않음, **Late Fusion 유지**

### 5.7 패치 전략 오버피팅 문제 (01-29 ~ 02-01) ⚠️

- **현상**: Patch 모델 Test F1 = 0.874 ~ 0.948 (비정상적으로 높음)
- **오버피팅 원인**:
  1. **인접 패치 유사성**: 같은 슬라이스에서 분할된 패치들이 거의 동일한 텍스처/노이즈 보유
  2. **배터리 수 부족**: Train 92개 배터리 → 1.33M 패치 (배터리당 14,000+ 패치)
  3. **배터리별 암기**: 모델이 "결함 패턴"이 아닌 "배터리 고유 특성" 학습
- **실제 적용 시 예상**:
  - 새로운 배터리에서 성능 급락 예상
  - 92개 배터리 학습으로는 일반화 어려움
- **결론**: 패치 결과(F1=0.948)는 신뢰할 수 없음, **Image-Only(F1=0.792)가 현실적**

### 5.8 테스트 Split 변경으로 이전 결과 무효화 (02-12~14) ⚠️

- **현상**: 02-07 ConvNeXt no_x F1=0.976, 02-11 ResNet18 F1=0.949 → 현재 split으로 재테스트 시 F1=0.54~0.68
- **원인**:
  1. `fix_ct_split_by_battery.py` 및 `fix_all_ct_splits.py` 실행으로 split 파일 재생성
  2. 이전 split: cell_n=3,240, cell_p=11,316, mod_n=1,620, mod_p=20,221, mod_r=27 (36,424)
  3. 현재 split: cell_n=10,655, cell_p=3,870, mod_n=11,089, mod_p=9,542, mod_r=373 (35,529)
  4. 클래스 분포가 완전히 다름 → 이전 결과 무효
- **영향**: 이전 split 기반 결과 (02-06, 02-07, 02-11, EfficientNet-B0)는 현재와 비교 불가
- **교훈**: split 변경 시 반드시 모든 모델 재테스트 필요

### 5.9 예측 과신뢰(Overconfidence) 문제 (02-14) ⚠️

- **현상**: 모델이 오답에도 90%+ 확률로 예측
- **분석 (ConvNeXt no_x 기준)**:
  - 평균 예측 신뢰도: 91.6% (실제 정확도: 64.6%)
  - 정답 시 평균 신뢰도: 95.4%
  - **오답 시 평균 신뢰도: 84.6%**
  - 90%+ 신뢰도로 예측한 것 중 25.4%가 오답
- **원인**: 과적합으로 인한 softmax 분포 sharp화 (temperature 문제)
- **영향**: 신뢰도 기반 필터링이 무의미 (높은 확률로 틀림)
- **해결 방향**: Temperature Scaling, Calibration 적용 필요

### 5.10 no_x 학습 모델의 전체 테스트 문제 (02-14) ⚠️

- **현상**: no_x 모델(y/z축만 학습)이 전체 테스트셋(x/y/z축)에서 성능 저조
- **원인**:
  1. no_x 모델은 x축 데이터를 학습에서 본 적 없음
  2. 테스트 설정이 `resize512/battery_test.txt` (x축 포함)를 사용
  3. x축 슬라이스에 결함이 없으나 배터리 라벨을 따름 → 모델 혼란
- **결과**: no_x 학습의 Val F1(0.71~0.77) vs 전체 테스트 F1(0.54~0.68) 큰 격차
- **교훈**: 학습과 테스트 데이터 조건 일치 필요

---

## 6. 데이터셋 통계

### 6.1 클래스 분포 변화

| 클래스 | 원본 (슬라이스) | 패치 | 밸런싱 후 |
|--------|----------------|------|-----------|
| 0: cell_normal | 8,461 (23%) | 44,624 (3.3%) | 44,624 (13.7%) |
| 1: cell_porosity | 6,095 (17%) | 53,470 (4.0%) | 53,470 (16.4%) |
| 2: module_normal | 11,191 (31%) | 116,589 (8.7%) | 116,589 (35.8%) |
| 3: module_porosity | 10,650 (29%) | 1,108,345 (83.1%) | **100,000 (30.7%)** |
| 4: module_resin | 27 (0.1%) | 10,578 (0.8%) | 10,578 (3.3%) |
| **Total** | 36,424 | 1,333,606 | **325,261** |

### 6.2 현재 Resize 512 Split (02-12 이후)

> `fix_all_ct_splits.py` 실행 후 재생성된 현재 유효 split

#### 전체 (x축 포함)
| Split | 총 샘플 | cell_normal | cell_porosity | module_normal | module_porosity | module_resin |
|-------|---------|-------------|---------------|---------------|-----------------|--------------|
| Train | 138,334 | 35,658 | 16,165 | - | - | - |
| Val | 27,539 | 7,840 | 1,861 | - | - | - |
| **Test** | **35,529** | **10,655 (30%)** | **3,870 (11%)** | **11,089 (31%)** | **9,542 (27%)** | **373 (1%)** |

#### no_x (x축 제외)
| Split | 총 샘플 | 비고 |
|-------|---------|------|
| Train | 105,224 | y/z축만 |
| Val | 20,751 | y/z축만 |
| Test | 26,606 | y/z축만 |

### 6.3 이전 Split (삭제됨, 참고용)

| Split 유형 | 테스트 샘플 | cell_n | cell_p | mod_n | mod_p | mod_r |
|------------|-----------|--------|--------|-------|-------|-------|
| 이전 resize512 | 36,424 | 3,240 (9%) | 11,316 (31%) | 1,620 (4%) | 20,221 (55%) | 27 (0.07%) |
| 이전 resize512_no_x | 29,899 | 2,240 | 8,807 | 1,853 | 16,694 | 305 |
| 이전 no_x test | 32,492 | 3,240 | 11,499 | 1,324 | 16,055 | 374 |

> **핵심 차이**: 이전 split은 module_porosity가 55%로 극심한 불균형, 현재 split은 27%로 개선

### 6.4 배터리 단위 분리 (Data Leakage 없음)

| Split | 배터리 수 | 중복 |
|-------|----------|------|
| Train | 92 | 없음 |
| Val | 17 | 없음 |
| Test | 25 | 없음 |

---

## 7. 체크포인트 목록

### 7.1 권장 체크포인트 (현재 split 기준)

| 모델 | 체크포인트 | Val F1 | Test F1 | 권장 | 비고 |
|------|-----------|--------|---------|------|------|
| **Late Fusion v2** | `late_fusion_best_20260214_161538.pt` | 0.824 | **0.803** | **★** | **✅ 현재 split 최고, 가장 안정적** |
| **Metadata v3** | `metadata_best_20260213_175635.pt` | 0.793 | **0.791** | **★** | ✅ 현재 split, ROC-AUC 최고 |
| DRN+ASPP | `ct_drn_aspp_best_20260215_184445.pt` | 0.789 | 0.794 | O | ✅ 현재 split, 다중스케일 |
| CBAM 768 | `ct_cbam_768_best_20260211_200858.pt` | - | 0.862 | O | ✅ 현재 split (x축 포함 학습) |
| EfficientNet-B4 no_x | `ct_efficientnet_b4_no_x_best_20260212_232648.pt` | 0.766 | 0.679 | △ | no_x 학습, 전체 테스트 |
| DeepLabV3+ (freeze) | `deeplabv3_best_20260218_211437.pt` | 0.302 | - | X | ❌ backbone freeze, 학습 실패 |
| RGB AE | `rgb_ae_best_20260107_123958.pt` | - | 0.909 | O | RGB 전용 |
| CT AE | `ct_ae_best_20260127_190546.pt` | - | 0.653 | X | 성능 저조 |

> ⚠️ 이전 split 기반 고성능 결과 (ConvNeXt F1=0.976 등)는 split 변경으로 무효

### 7.2 전체 체크포인트 (날짜순)

```
models/ct_cnn/checkpoints/
├── ct_unified_best_20260105_140553.pt    # ResNet18, Outline
├── ct_unified_best_20260118_*.pt         # ResNet18, 설정 테스트
├── ct_unified_best_20260119_145358.pt    # ResNet18, 테스트 있음
├── ct_unified_best_20260120_*.pt         # ResNet18
├── ct_unified_best_20260121_*.pt         # ResNet18
├── ct_unified_best_20260122_150732.pt    # CBAM
├── ct_unified_best_20260123_153748.pt    # ResNet18
├── hierarchical_best_20260124_182039.pt  # Hierarchical (실패)
├── ct_unified_best_20260125_*.pt         # ResNet18
├── metadata_best_20260126_*.pt           # Metadata (스타일 학습 문제)
├── metadata_best_20260128_*.pt           # Metadata (축 학습 문제)
├── metadata_best_20260129_*.pt           # Metadata, Patch
├── metadata_best_20260201_163846.pt      # Metadata, Patch, Balanced
├── image_only_best_20260202_143210.pt    # Image-Only, Outline Crop
├── late_fusion_best_20260203_111615.pt   # Late Fusion, Outline Crop
├── hdcnn_best_20260204_162940.pt         # HD-CNN (성능 저조)
├── ct_unified_best_20260205_191742.pt    # ResNet18, Resize 512
├── ct_convnext_tiny_best_20260206_120001.pt # ConvNeXt-Tiny, Resize 512 (x포함)
├── ct_convnext_tiny_best_20260206_162045.pt # ConvNeXt-Tiny, Resize 512 (no x)
├── ct_efficientnet_b0_best_20260207_111726.pt # EfficientNet-B0 (이전 split)
├── ct_cbam_768_best_20260211_200858.pt   # CBAM, Resize 768 (균형 분할)
├── ct_unified_resnet18_no_x_best_20260212_141145.pt # ResNet18, no_x
├── ct_cbam_768_no_x_best_20260212_153103.pt # CBAM 768, no_x
├── ct_convnext_tiny_no_x_best_20260212_182034.pt # ConvNeXt, no_x
├── ct_efficientnet_b4_no_x_best_20260212_232648.pt # EfficientNet-B4, no_x
├── hdcnn_best_20260213_151426.pt         # HD-CNN v2 (성능 저조)
├── metadata_best_20260213_175635.pt      # Metadata v3 ★
├── late_fusion_best_20260214_161538.pt   # Late Fusion v2 ★★ (현재 최고)
├── ct_drn_aspp_best_20260215_184445.pt   # DRN+ASPP ★
└── deeplabv3_best_20260218_211437.pt     # DeepLabV3+ (freeze, 학습 실패)

models/ct_ae/checkpoints/
└── ct_ae_best_20260127_190546.pt         # CT AE (성능 저조)

models/rgb_ae/checkpoints/
├── rgb_ae_best_20260106_124424.pt        # RGB AE
└── rgb_ae_best_20260107_123958.pt        # RGB AE ★
```

---

## 8. 결론 및 권장 사항

### 8.1 현재 split 기준 최고 성능 ✅

> 현재 유효한 split (35,529 샘플, 균형 분포) 기반 결과만 포함

| 순위 | 모델 | Test F1 | Accuracy | ROC-AUC | 특징 |
|------|------|---------|----------|---------|------|
| **1** | **Late Fusion v2 (02-14)** | **0.803** | **80.3%** | **0.944** | **메타데이터 + 이미지, 가장 안정적** |
| 2 | DRN+ASPP (02-18) | 0.794 | 78.2% | 0.943 | 다중스케일 특징 추출, 순수 이미지 최고 |
| 3 | Metadata v3 (02-14) | 0.791 | 78.0% | 0.965 | 메타데이터 효과, ROC-AUC 최고 |
| 4 | CBAM 768 (02-12) | 0.862 | 86.3% | 0.968 | x축 포함 학습, 높은 F1 |
| 5 | EfficientNet-B4 no_x (02-14) | 0.679 | 66.7% | 0.912 | no_x 학습 → 전체 테스트 |
| 6 | ConvNeXt no_x (02-14) | 0.571 | 64.6% | 0.891 | no_x 학습 → 전체 테스트 |
| - | DeepLabV3+ freeze (02-18) | - | - | - | ❌ 학습 실패 (Val F1=0.302) |
| - | HD-CNN v2 (02-14) | 0.337 | 38.5% | - | ❌ 성능 극히 저조 |

> ⚠️ 이전 split 기반 고성능 결과 (ConvNeXt F1=0.976, EfficientNet-B0 F1=0.987 등)는 split 재생성으로 **무효**
> ⚠️ 패치 전략 결과 (F1=0.948)는 오버피팅으로 **신뢰 불가**

### 8.2 핵심 발견

1. **메타데이터 효과 재검증**: DRN+ASPP(순수 이미지, F1=0.794)가 메타데이터 모델과 대등
   - Late Fusion v2 (0.803) vs DRN+ASPP (0.794): **+0.009** (메타데이터 효과 미미)
   - DRN+ASPP (0.794) vs EfficientNet-B4 no_x (0.679): **+0.115** (ASPP 다중스케일 효과)
2. **no_x 학습 → 전체 테스트 불일치**: x축 미경험 모델이 x축 포함 테스트에서 성능 저조
3. **모든 모델 과적합**: 9개 신규 학습 모두 과적합 (Val loss 증가), Late Fusion만 경미
4. **예측 과신뢰**: 오답에도 84~91% 신뢰도 → 신뢰도 기반 필터링 무의미
5. **cell_porosity 난제**: 모든 모델에서 가장 낮은 F1 (0.27~0.65)
6. **DeepLabV3+ backbone freeze 실패**: 사전학습 backbone을 freeze하고 classifier만 학습 → Val F1=0.302
7. **VLM (Qwen3-VL) CT 분류 한계**: zero-shot 5클래스 분류 Accuracy 20% (랜덤 수준)

### 8.3 핵심 문제

1. **x축 숏컷 학습**: x축 슬라이스에 결함이 보이지 않으나 배터리 라벨을 따름 → 모델 혼란
2. **cell_porosity 탐지 어려움**: cell_normal과 시각적 차이 미미 → F1 0.27~0.65
3. **배터리 수 부족**: 92개 학습 배터리로 일반화 한계 → 모든 모델 과적합
4. **CT AE 성능 저조**: ROC-AUC 0.653으로 앙상블 기여 불가
5. **Split 변경 문제**: split 재생성으로 이전 결과 전부 무효화

### 8.4 권장 다음 단계

1. ~~**Late Fusion v2 학습**~~ ✅ 완료 - Test F1 = 0.803 (현재 split 최고)
2. ~~**Metadata v3 학습**~~ ✅ 완료 - Test F1 = 0.791
3. ~~**no_x 모델 4종 학습/테스트**~~ ✅ 완료 - F1 = 0.54~0.68 (성능 저조)
4. ~~**HD-CNN v2 학습**~~ ❌ 실패 - Test F1 = 0.337
5. ~~**DRN+ASPP 학습**~~ ✅ 완료 - Test F1 = 0.794 (순수 이미지 최고)
6. ~~**DeepLabV3+ 학습**~~ ❌ 실패 - Val F1 = 0.302 (backbone freeze로 학습 불가)
7. ~~**VLM Qwen3-VL 2B 대규모 평가**~~ ❌ 확정 실패 - 500샘플: Accuracy 20.8%, F1 0.082 (zero-shot 무의미)
8. **VLM Qwen3-VL 8B 대규모 평가**: GPU 24GB+ 필요 (현재 12GB에서 CPU 오프로드로 느림)
9. **과적합 해결**: 더 강한 정규화 (Dropout 0.7, MixUp/CutMix, Label Smoothing 0.15)
10. **Temperature Scaling**: 예측 과신뢰 보정
11. **더 많은 배터리 데이터 확보**: 현재 92개 → 최소 200개 이상 필요
12. **x축 처리 전략 확정**: 운영 환경에서 x축 제외 가능 여부 결정

---

## 9. Resize 512 재학습 실험 분석 (02-05 ~ 02-14)

### 9.1 실험 개요

기존 Outline Crop 1024 전처리 대신 **원본 4000x4000 CT 이미지를 직접 512x512로 리사이즈**하는 전략으로 다양한 아키텍처를 재학습.

| 항목 | 내용 |
|------|------|
| 전처리 | Raw 4000→512/768 직접 리사이즈 (crop 없음) |
| 데이터 분할 | 배터리 단위 분리 (train 92 / val 17 / test 25, data leakage 없음) |
| 핵심 변수 | x축 포함 여부, 모델 아키텍처, 이미지 해상도, 메타데이터 유무 |
| Split 변경 | 02-12 `fix_all_ct_splits.py` 실행 → 이전 split 무효화 |

### 9.2 실험 Phase 정리

#### Phase 1: 이전 split 기반 (02-05 ~ 02-12) ⚠️

> 아래 결과는 이전 split (삭제됨) 기반으로 현재와 직접 비교 불가. x축 효과 분석에만 참고.

| 모델 | 이미지 크기 | x축 | Test F1 | Accuracy | 테스트 샘플 | 테스트 날짜 |
|------|-----------|-----|---------|----------|-----------|-----------|
| ResNet18 | 512 | 포함 | 0.645 | 88.7% | 36,424 | 02-06 |
| ConvNeXt-Tiny | 512 | 포함 | 0.864 | 93.1% | 36,424 | 02-06 |
| ConvNeXt-Tiny | 512 | 제외 | 0.976 | 98.6% | 29,899 | 02-07 |
| ResNet18 | 512 | 학습포함/테스트제외 | 0.949 | 96.8% | 32,492 | 02-11 |
| EfficientNet-B0 | 512 | 제외 | 0.987 | 99.1% | 32,492 | 02-14 |

#### Phase 2: 현재 split 기반 (02-12 ~ 02-14) ✅

> 현재 유효한 테스트 결과. 35,529 샘플 (균형 분포).

| 모델 | 이미지 크기 | x축 학습 | 메타데이터 | Val F1 | Test F1 | Accuracy | ROC-AUC |
|------|-----------|---------|----------|--------|---------|----------|---------|
| **Late Fusion v2** | 512 | 포함 | ✅ | 0.824 | **0.803** | **80.3%** | 0.944 |
| DRN+ASPP | 512 | 포함 | ❌ | 0.789 | 0.794 | 78.2% | 0.943 |
| Metadata v3 | 512 | 포함 | ✅ | 0.793 | 0.791 | 78.0% | 0.965 |
| CBAM 768 | 768 | 포함 | ❌ | - | 0.862 | 86.3% | 0.968 |
| EfficientNet-B4 no_x | 512 | **제외** | ❌ | 0.766 | 0.679 | 66.7% | 0.912 |
| ConvNeXt no_x | 512 | **제외** | ❌ | 0.771 | 0.571 | 64.6% | 0.891 |
| ResNet18 no_x | 512 | **제외** | ❌ | 0.712 | 0.545 | 60.1% | 0.864 |
| CBAM 768 no_x | 768 | **제외** | ❌ | 0.731 | 0.540 | 60.3% | 0.895 |
| HD-CNN v2 | 512 | 포함 | ❌ | 0.547 | 0.337 | 38.5% | - |
| DeepLabV3+ (freeze) | 512 | 포함 | ❌ | 0.302 | - | - | - | ❌ backbone freeze, 학습 실패 |

### 9.3 학습 과적합 분석 (9개 신규 학습)

| 모델 | Train Loss (시작→끝) | Val Loss (시작→끝) | Best Epoch | Val F1 | 과적합 |
|------|---------------------|-------------------|------------|--------|--------|
| ResNet18 no_x | 0.214→0.074 | 0.734→1.190 | 5/12 | 0.712 | **심각** |
| ConvNeXt no_x | 0.150→0.065 | 0.589→0.883 | 4/11 | 0.771 | **심각** |
| CBAM 768 no_x | 0.220→0.063 | 0.484→1.166 | 1/8 | 0.731 | **극심** |
| EfficientNet-B4 no_x | 0.200→0.052 | 0.576→1.175 | 5/12 | 0.766 | **심각** |
| HD-CNN v2 | 2.539→0.747 | 2.437→11.508 | 7/14 | 0.547 | **극심** (붕괴) |
| Metadata v3 | 1.445→0.209 | 0.484→0.746 | 5/13 | 0.793 | **심각** |
| **Late Fusion v2** | **1.118→0.191** | **0.475→0.584** | **5/12** | **0.824** | **경미** |
| DRN+ASPP | 0.182→0.065 | 0.392→0.904 | 9/16 | 0.789 | **심각** |
| DeepLabV3+ (freeze) | 1.065→0.963 | 0.791→0.741 | 7/9 | 0.302 | ❌ **학습 실패** (backbone freeze) |

> 7개 중 Late Fusion v2만 경미한 과적합, 나머지 6개 모두 심각~극심

### 9.4 핵심 발견

#### 1) 메타데이터가 핵심 성능 요인
| 비교 | 메타데이터 없음 | 메타데이터 있음 | 차이 |
|------|---------------|---------------|------|
| 최고 순수 이미지 (DRN+ASPP) | F1=0.794 | - | - |
| Late Fusion v2 | - | F1=0.803 | **+0.009** |
| Metadata v3 | - | F1=0.791 | -0.003 |

#### 2) no_x 학습 → 전체 테스트의 Val/Test 격차
| 모델 | Val F1 (no_x) | Test F1 (전체) | 격차 |
|------|--------------|---------------|------|
| ResNet18 no_x | 0.712 | 0.545 | **-0.167** |
| ConvNeXt no_x | 0.771 | 0.571 | **-0.200** |
| CBAM 768 no_x | 0.731 | 0.540 | **-0.191** |
| EfficientNet-B4 no_x | 0.766 | 0.679 | **-0.087** |

> no_x 학습 모델이 x축 포함 테스트에서 평균 -0.16 F1 하락

#### 3) 예측 과신뢰 (Overconfidence)

ConvNeXt no_x 기준 신뢰도 분석:
| 구분 | 평균 신뢰도 | 비율 |
|------|-----------|------|
| 전체 예측 | 91.6% | 100% |
| 정답 | 95.4% | 64.6% |
| **오답** | **84.6%** | **35.4%** |
| 90%+ 신뢰도 중 오답 | - | **25.4%** |

> 모델이 틀려도 높은 확률로 예측 → Temperature Scaling 보정 필요

### 9.5 이전 split에서의 X축 효과 분석 (참고용)

**동일 체크포인트(ResNet18)로 x축 포함/제외 테스트 비교 (이전 split):**

| 지표 | x축 포함 | x축 제외 | 변화 |
|------|---------|---------|------|
| F1 Macro | 0.645 | 0.949 | **+0.304 (+47%)** |
| cell_normal F1 | 0.415 | 0.896 | **+0.481** |
| module_resin F1 | 0.335 | 1.000 | +0.665 |

> x축 제거가 가장 큰 성능 향상 요인이었으나, 이 결과는 이전 split 기반

### 9.6 현재 split 테스트 데이터

| 항목 | 값 |
|------|-----|
| 총 샘플 | 35,529 |
| cell_normal | 10,655 (30%) |
| cell_porosity | 3,870 (11%) |
| module_normal | 11,089 (31%) |
| module_porosity | 9,542 (27%) |
| module_resin_overflow | 373 (1%) |
| 배터리 수 | 25개 |
| x축 포함 여부 | 포함 |

### 9.7 결론

1. **현재 split 최고 성능은 Late Fusion v2 (F1=0.803)**: 메타데이터 + 이미지 결합이 효과적
2. **DRN+ASPP가 순수 이미지 모델 중 최고 (F1=0.794)**: 메타데이터 없이도 ASPP 다중스케일 특징으로 준수한 성능
3. **DeepLabV3+ (freeze)는 학습 실패 (Val F1=0.302)**: backbone freeze 상태에서 classifier만으로는 불충분
4. **순수 이미지 no_x 모델은 성능 저조 (F1=0.54~0.68)**: x축 학습 미경험 + 전체 테스트 불일치
5. **모든 모델 과적합**: 92개 배터리로 일반화 한계, Late Fusion만 경미
6. **이전 split 고성능 결과 (F1=0.976~0.987)는 무효**: split 재생성으로 현재와 비교 불가
7. **cell_porosity가 일관된 약점**: 현재 split 전 모델에서 F1 0.27~0.65
8. **VLM (Qwen3-VL)은 CT 5클래스 분류에 부적합**: 2B 모델 Accuracy 20% (랜덤 수준)

### 9.8 전체 테스트 명령어

```bash
# === 현재 split 기반 모델 (35,529 샘플) ===

# Late Fusion v2 ★ (현재 최고)
python models/ct_cnn/test_late_fusion.py \
  --checkpoint models/ct_cnn/checkpoints/late_fusion_best_20260214_161538.pt

# Metadata v3
python models/ct_cnn/test_metadata.py \
  --checkpoint models/ct_cnn/checkpoints/metadata_best_20260213_175635.pt

# CBAM 768
python models/ct_cnn/test.py \
  --checkpoint models/ct_cnn/checkpoints/ct_cbam_768_best_20260211_200858.pt

# ResNet18 no_x
python models/ct_cnn/test.py \
  --checkpoint models/ct_cnn/checkpoints/ct_unified_resnet18_no_x_best_20260212_141145.pt

# ConvNeXt no_x
python models/ct_cnn/test.py \
  --checkpoint models/ct_cnn/checkpoints/ct_convnext_tiny_no_x_best_20260212_182034.pt

# CBAM 768 no_x
python models/ct_cnn/test.py \
  --checkpoint models/ct_cnn/checkpoints/ct_cbam_768_no_x_best_20260212_153103.pt

# EfficientNet-B4 no_x
python models/ct_cnn/test.py \
  --checkpoint models/ct_cnn/checkpoints/ct_efficientnet_b4_no_x_best_20260212_232648.pt

# HD-CNN v2
python models/ct_cnn/test_hdcnn.py \
  --checkpoint models/ct_cnn/checkpoints/hdcnn_best_20260213_151426.pt

# DRN+ASPP
python models/ct_cnn/test.py \
  --checkpoint models/ct_cnn/checkpoints/ct_drn_aspp_best_20260215_184445.pt \
  --config training/configs/cnn_ct_drn_aspp.yaml
```
