graph TB
    subgraph "Frontend - Streamlit UI"
        A[사용자] -->|이미지 업로드| B[Image Uploader]
        B --> C[API Client]
    end

    subgraph "Backend - FastAPI Server"
        C -->|POST /infer| D[API Router]
        D --> E[Inference Pipeline]
        
        E --> F1[CNN Predictor]
        E --> F2[AutoEncoder Predictor]
        E --> F3[VLM Inference]
        E --> F4[VLG Inference]
        
        subgraph "CNN Module"
            F1 --> G1[ResNet50 Model]
            G1 --> G2[Grad-CAM]
            G2 --> G3[BBox Extractor]
            G3 --> G4[Visualizer]
        end
        
        subgraph "AutoEncoder Module"
            F2 --> H1[AE Model]
            H1 --> H2[Anomaly Score]
            H2 --> H3[Threshold Compare]
        end
        
        subgraph "VLM Module"
            F3 --> I1[Qwen3-VL]
            I1 --> I2[Zero-shot Classification]
        end
        
        subgraph "VLG Module"
            F4 --> J1[GroundingDINO]
            J1 --> J2[BBox Detection]
        end
        
        G4 --> K[Result Aggregator]
        H3 --> K
        I2 --> K
        J2 --> K
        
        K --> L[Result Saver]
        L -->|job_id| M[(experiments/runs/)]
    end
    
    subgraph "Storage"
        M --> N1[results/*.json]
        M --> N2[visualizations/*.jpg]
        M --> N3[summary.json]
    end
    
    subgraph "Response"
        N3 --> O[JSON Response]
        O --> P[Result Viewer]
        P --> Q1[CNN Tab<br/>- Classification<br/>- Grad-CAM<br/>- BBox]
        P --> Q2[AutoEncoder Tab<br/>- Anomaly Score<br/>- Reconstruction]
        P --> Q3[VLM Tab<br/>- Text Description<br/>- Classification]
        P --> Q4[VLG Tab<br/>- BBox Detection]
        P --> Q5[Comparison View<br/>- Side-by-side<br/>- Metrics]
    end
    
    Q5 --> A

    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#fff4e1
    style D fill:#ffe1e1
    style E fill:#ffe1e1
    style K fill:#ffe1e1
    style L fill:#ffe1e1
    style M fill:#e1ffe1
    style P fill:#f0e1ff
    style Q5 fill:#f0e1ff
